<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics & Insights</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="css/styles.css">
    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        /* Fixed map background */
        #map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        #map-container.dimmed {
            opacity: 0.3;
        }

        /* Disable all map interactions for background map only */
        #map-container .leaflet-container {
            cursor: default !important;
        }

        #map-container .leaflet-control-container {
            display: none !important;
        }

        .page-wrapper {
            position: relative;
            z-index: 2;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
        }

        header {
            position: relative;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.1), rgba(0,0,0,0.3));
            color: white;
            padding: 30px 30px 25px;
            margin-bottom: 0;
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .nav-buttons {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            z-index: 10;
        }

        .nav-button {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 4px rgba(0,0,0,0.8);
        }

        .nav-button:hover {
            background: rgba(0, 0, 0, 0.9);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .nav-button:active {
            transform: translateY(0);
        }

        header h1 {
            color: white;
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.15em;
            font-weight: 300;
            margin-bottom: 12px;
        }

        .disclaimers-section {
            position: relative;
            background: rgba(255, 243, 205, 0.85);
            border-left: 4px solid #ffc107;
            padding: 10px 20px;
            margin: 0;
            backdrop-filter: blur(10px);
        }

        .disclaimers-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .disclaimers-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #856404;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .disclaimers-title::before {
            content: "⚠️";
            font-size: 1em;
        }

        .disclaimer-text {
            margin: 0;
            color: #856404;
            line-height: 1.6;
            font-size: 0.9em;
        }

        .insights-section {
            position: relative;
            padding: 25px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.1), rgba(0,0,0,0.3));
            min-height: calc(100vh - 400px);
        }

        .insights-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .insights-title {
            font-size: 2.2em;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .stats-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8em;
            font-weight: 600;
            color: white;
            margin-bottom: 15px;
            padding-bottom: 6px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card.enrollment {
            border-left-color: #3498db;
        }

        .stat-card.capacity {
            border-left-color: #e74c3c;
        }

        .stat-label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            line-height: 1;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .stat-detail {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            margin-top: 5px;
        }

        .stat-note {
            background: rgba(255, 255, 255, 0.15);
            border-left: 3px solid rgba(255, 255, 255, 0.5);
            padding: 8px 12px;
            margin-top: 12px;
            border-radius: 4px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .timeslots-table-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
        }

        .timeslots-table {
            width: 100%;
            border-collapse: collapse;
            color: white;
        }

        .timeslots-table thead {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10;
        }

        .timeslots-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.9);
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        .timeslots-table td {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9em;
        }

        .timeslots-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .timeslot-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .timeslot-time {
            font-weight: 600;
            color: white;
        }

        .timeslot-count {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
        }

        .timeslot-empty {
            color: rgba(255, 255, 255, 0.3);
            font-style: italic;
        }

        .peak-times-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        @media (max-width: 1400px) {
            .peak-times-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        .peak-time-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border-left: 4px solid #667eea;
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .peak-time-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .peak-time-card.monday {
            border-left-color: #3498db;
        }

        .peak-time-card.tuesday {
            border-left-color: #e74c3c;
        }

        .peak-time-card.wednesday {
            border-left-color: #f39c12;
        }

        .peak-time-card.thursday {
            border-left-color: #9b59b6;
        }

        .peak-time-card.friday {
            border-left-color: #1abc9c;
        }

        .peak-time-day {
            font-size: 1.3em;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .peak-time-slot {
            font-size: 1.1em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 8px;
        }

        .peak-time-meetings {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
        }

        .peak-time-rooms {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .room-usage-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-usage-label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
        }

        .room-usage-value {
            font-size: 1.4em;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .room-usage-percentage {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
        }

        .capacity-row {
            cursor: help;
            position: relative;
        }

        .capacity-row:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 4px 8px;
            margin: -4px -8px;
        }

        .capacity-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: normal;
            max-width: 300px;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            transition: opacity 0.2s ease, visibility 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            line-height: 1.4;
        }

        .capacity-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.95);
        }

        .capacity-row:hover .capacity-tooltip {
            visibility: visible;
            opacity: 1;
        }

        .buildings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .building-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border-left: 4px solid #667eea;
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .building-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .building-card.top-1 {
            border-left-color: #f39c12;
        }

        .building-card.top-2 {
            border-left-color: #e74c3c;
        }

        .building-card.top-3 {
            border-left-color: #3498db;
        }

        .building-rank {
            font-size: 1.5em;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .building-name {
            font-size: 1.6em;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .building-stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .building-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .building-stat-label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
        }

        .building-stat-value {
            font-size: 1.2em;
            font-weight: 600;
            color: white;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .swap-examples-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .swap-example-card {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border-left: 4px solid #1abc9c;
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .swap-example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .swap-example-title {
            font-size: 1.4em;
            font-weight: 700;
            color: white;
            margin-bottom: 12px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
        }

        .swap-example-details {
            font-size: 1em;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .swap-example-details strong {
            color: white;
            font-weight: 600;
        }

        .swap-example-image {
            margin-top: 20px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            width: 33.33%;
            margin-left: auto;
            margin-right: auto;
        }

        .swap-example-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        @media (max-width: 768px) {
            .swap-examples-container {
                grid-template-columns: 1fr;
            }

            header {
                padding: 25px 20px 20px;
            }

            header h1 {
                font-size: 2em;
            }

            .nav-buttons {
                padding: 0 20px;
                top: 15px;
            }

            .nav-button {
                padding: 8px 15px;
                font-size: 0.85em;
            }

            .disclaimers-section {
                padding: 8px 15px;
            }

            .insights-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Fixed map background -->
    <div id="map-container"></div>
    
    <div class="page-wrapper">
        <div class="container">
            <header>
                <div class="nav-buttons">
                    <a href="story.html" class="nav-button">← Back to Story</a>
                    <a href="capacity-full.html" target="_blank" class="nav-button">View Full Map →</a>
                </div>
                <h1>Analytics & Insights</h1>
            </header>

            <div class="disclaimers-section">
                <div class="disclaimers-content">
                    <h2 class="disclaimers-title">Important Disclaimers</h2>
                    <p class="disclaimer-text">
                        Please do not assume all information is accurate. Room availability does not account for clubs or other events. We only have actual capacity data for ~46% of rooms. Some courses require special classrooms for labs, etc. This analysis is not meant to slander UVM in any way.
                    </p>
                </div>
            </div>

            <div class="insights-section">
                <div class="insights-content">
                    <h2 class="insights-title">Big Picture</h2>
                    
                    <!-- Enrollment Statistics -->
                    <div class="stats-section">
                        <h3 class="section-title">Enrollment Statistics (Max Enrollment vs Current Enrollment)</h3>
                        <div class="stats-grid">
                            <div class="stat-card enrollment">
                                <div class="stat-label">Courses At or Over Max Enrollment</div>
                                <div class="stat-value" id="stat-enrollment-at-or-over">-</div>
                                <div class="stat-detail">Courses where current enrollment ≥ max enrollment</div>
                            </div>
                            <div class="stat-card enrollment">
                                <div class="stat-label">Courses Exceeding Max Enrollment</div>
                                <div class="stat-value" id="stat-enrollment-exceeding">-</div>
                                <div class="stat-detail">Courses where current enrollment > max enrollment</div>
                            </div>
                            <div class="stat-card enrollment">
                                <div class="stat-label">Average Over Max Enrollment</div>
                                <div class="stat-value" id="stat-enrollment-avg-over">-</div>
                                <div class="stat-detail">Average number of students over max enrollment</div>
                            </div>
                        </div>
                    </div>

                    <!-- Capacity Statistics -->
                    <div class="stats-section">
                        <h3 class="section-title">Room Capacity Statistics (True Capacity Only)</h3>
                        <div class="stat-note">
                            <strong>Note:</strong> Only includes courses where we have their true room capacity data (only around 46% of all rooms). 
                            Approximately <span id="stat-total-true-capacity">-</span> courses have verified capacity data.
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card capacity">
                                <div class="stat-label">Courses At or Over Room Capacity</div>
                                <div class="stat-value" id="stat-capacity-at-or-over">-</div>
                                <div class="stat-detail">Courses where current enrollment ≥ room capacity</div>
                            </div>
                            <div class="stat-card capacity">
                                <div class="stat-label">Courses Exceeding Room Capacity</div>
                                <div class="stat-value" id="stat-capacity-exceeding">-</div>
                                <div class="stat-detail">Courses where current enrollment > room capacity</div>
                            </div>
                            <div class="stat-card capacity">
                                <div class="stat-label">Average Over Room Capacity</div>
                                <div class="stat-value" id="stat-capacity-avg-over">-</div>
                                <div class="stat-detail">Average number of students over room capacity</div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeslots by Day -->
                    <div class="stats-section">
                        <h3 class="section-title">Class Meeting Timeslots by Day</h3>
                        <div class="stat-note">
                            <strong>Note:</strong> Shows all timeslots ranked by number of class meetings. Scroll to see all timeslots.
                        </div>
                        <div class="timeslots-table-container">
                            <table class="timeslots-table" id="timeslots-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Monday</th>
                                        <th>Tuesday</th>
                                        <th>Wednesday</th>
                                        <th>Thursday</th>
                                        <th>Friday</th>
                                    </tr>
                                </thead>
                                <tbody id="timeslots-tbody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Peak Times and Room Usage -->
                    <div class="stats-section">
                        <h3 class="section-title">Peak Usage Times</h3>
                        <div class="stat-note">
                            <strong>Note:</strong> Shows the busiest timeslot for each day and how many rooms are in use at that peak time.
                        </div>
                        <div class="peak-times-grid" id="peak-times-grid">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div class="stat-note" style="margin-top: 20px;">
                            Even during peak times, there are still seemingly many rooms that could be used.
                        </div>
                    </div>

                    <!-- Top Used Buildings -->
                    <div class="stats-section">
                        <h3 class="section-title">Top Used Buildings</h3>
                        <div class="buildings-grid" id="buildings-grid">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div class="stat-note" style="margin-top: 20px;">
                            As we can see, some buildings allocate space very well, but still have some classes where their enrollment exceeds the physical capacity. There are opportunities for simple swaps or utilizing unused room to provide some extra breathing room.
                        </div>
                    </div>

                    <!-- Room Swap Examples -->
                    <div class="stats-section">
                        <h3 class="section-title">Potential Room Swaps</h3>
                        <div class="stat-note">
                            <strong></strong>Here are two examples:
                        </div>
                        <div class="swap-examples-container">
                            <div class="swap-example-card">
                                <div class="swap-example-title">Lafayette Building</div>
                                <div class="swap-example-details">
                                    <strong>L407</strong> T/Th 1:15 PM - 2:30 PM. The room is at <strong>21 enrolled / 20 physical capacity</strong>. Seemingly, <strong>L309</strong> has availability during that time and can hold at least <strong>35 students</strong> (estimated capacity).
                                </div>
                                <div class="swap-example-image">
                                    <img src="images/Lafayette.png" alt="Lafayette Building room layout">
                                </div>
                            </div>
                            <div class="swap-example-card">
                                <div class="swap-example-title">Votey Building</div>
                                <div class="swap-example-details">
                                    <strong>V207</strong> MWF 9:40 AM - 10:30 AM is at <strong>52/50 capacity</strong>, while <strong>V307</strong> is at <strong>34/56 capacity</strong>. A simple swap would ensure both classes have ample room.
                                </div>
                                <div class="swap-example-image">
                                    <img src="images/Votey.png" alt="Votey Building room layout">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/config.js"></script>
    <script src="js/building-coordinates.js"></script>
    <script src="js/app-analytics.js"></script>
</body>
</html>

